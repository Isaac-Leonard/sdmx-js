{"version":3,"sources":["sdmx20.ts"],"names":["Sdmx20StructureParser","Sdmx20StructureParser.constructor","Sdmx20StructureParser.getVersionIdentifier","Sdmx20StructureParser.canParse","Sdmx20StructureParser.isStructure","Sdmx20StructureParser.isData","Sdmx20StructureParser.isMetadata","Sdmx20StructureParser.parseStructure","Sdmx20StructureParser.parseData","Sdmx20StructureReaderTools","Sdmx20StructureReaderTools.constructor","Sdmx20StructureReaderTools.toStructureType","Sdmx20StructureReaderTools.toHeader","Sdmx20StructureReaderTools.toCodelists","Sdmx20StructureReaderTools.toConcepts","Sdmx20StructureReaderTools.toKeyFamilies","Sdmx20StructureReaderTools.getStructureType","Sdmx20StructureReaderTools.myLoop","Sdmx20StructureReaderTools.myLoop2","Sdmx20StructureReaderTools.findNodeName","Sdmx20StructureReaderTools.findTextNode"],"mappings":"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ACLA,CAACA;gBAACA,IAAIA,CAACA,CAACA;oBACJA,GAAGA,IAAIA,CAACA,CAACA,SAASA,GAAGA,MAAMA,CAACA;gBAChCA,CAACA;YACLA,CAACA;YACDA,MAAMA,CAACA,GAAGA,CAACA;QACfA,CAACA;QACDR,4CAAOA,GAAPA,UAAQA,CAAMA;YACVS,IAAIA,CAASA,EAAEA,CAAMA,EAAEA,IAAYA,EAAEA,GAAWA,CAACA;YACjDA,GAAGA,GAAGA,EAAEA,CAACA;YACTA,CAACA,GAAGA,CAACA,CAACA,UAAUA,CAACA;YACjBA,IAAIA,GAAGA,CAACA,CAACA,MAAMA,CAACA;YAChBA,GAAGA,CAACA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,IAAIA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;gBACxBA,CAACA,GAAGA,CAACA,CAACA,CAACA,CAACA,CAACA;gBACTA,EAAEA,CAACA,CAACA,CAACA,CAACA,QAAQA,IAAIA,CAACA,CAACA,CAACA,CAACA;oBAClBA,KAAKA,CAACA,CAACA,CAACA,QAAQA,GAAGA,GAAGA,GAAGA,CAACA,CAACA,SAASA,CAACA,CAACA;oBACtCA,EAAEA,CAACA,CAACA,CAACA,CAACA,UAAUA,CAACA,CAACA,CAACA,IAAIA,SAASA,CAACA,CAACA,CAACA;wBAC/BA,GAAGA,IAAIA,IAAIA,CAACA,OAAOA,CAACA,CAACA,CAACA,CAACA;oBAC3BA,CAACA;gBACLA,CAACA;gBAACA,IAAIA,CAACA,CAACA;oBACJA,GAAGA,IAAIA,CAACA,CAACA,SAASA,GAAGA,MAAMA,CAACA;gBAEhCA,CAACA;YACLA,CAACA;YACDA,MAAMA,CAACA,GAAGA,CAACA;QACfA,CAACA;QACDT,iDAAYA,GAAZA,UAAaA,CAASA,EAAEA,UAAeA;YACnCU,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAWA,CAACA,EAAEA,CAACA,GAAGA,UAAUA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;gBACjDA,IAAIA,EAAEA,GAAWA,UAAUA,CAACA,CAACA,CAACA,CAACA,QAAQA,CAACA;gBACxCA,EAAEA,CAACA,CAACA,EAAEA,CAACA,OAAOA,CAACA,CAACA,CAACA,IAAIA,CAACA,CAACA,CAACA,CAACA,CAACA;oBACtBA,KAAKA,CAACA,aAAaA,GAACA,CAACA,CAACA,CAACA;oBACvBA,MAAMA,CAACA,UAAUA,CAACA,CAACA,CAACA,CAACA;gBACzBA,CAACA;YACLA,CAACA;YACDA,KAAKA,CAACA,iBAAiBA,GAACA,CAACA,CAACA,CAACA;YAC3BA,MAAMA,CAACA,IAAIA,CAACA;QAChBA,CAACA;QACDV,iDAAYA,GAAZA,UAAaA,IAASA;YAClBW,EAAEA,CAAAA,CAAEA,IAAIA,IAAIA,IAAKA,CAACA;gBAACA,MAAMA,CAACA,EAAEA,CAACA;YAC7BA,IAAIA,UAAUA,GAAGA,IAAIA,CAACA,UAAUA,CAACA;YACjCA,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAWA,CAACA,EAAEA,CAACA,GAAGA,UAAUA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;gBACjDA,IAAIA,QAAQA,GAAGA,UAAUA,CAACA,CAACA,CAACA,CAACA,QAAQA,CAACA;gBACtCA,EAAEA,CAACA,CAACA,QAAQA,IAAIA,CAACA,CAACA,CAACA,CAACA;oBAChBA,MAAMA,CAACA,UAAUA,CAACA,CAACA,CAACA,CAACA,SAASA,CAACA;gBACnCA,CAACA;YACLA,CAACA;YACDA,MAAMA,CAACA,EAAEA,CAACA;QACdA,CAACA;QAELX,iCAACA;IAADA,CA1GA,AA0GCA,IAAA;IA1GY,kCAA0B,6BA0GtC,CAAA;IAKD,IAAI,CAAC,MAAM,CAAC,sBAAsB,CAAC,IAAI,qBAAqB,EAAE,CAAC,CAAC","file":"sdmx20.js","sourcesContent":["/// <amd-module name='sdmx20'/>\n///<reference path=\"sax.d.ts\"/>\nimport sax = require(\"sax\");\nimport structure = require(\"structure\");\nimport message = require(\"message\");\nimport parser = require(\"parser\");\nimport sdmx = require(\"sdmx\");\nimport xml = require(\"xml\");\nimport parseXml = require(\"parseXml\");\nexport class Sdmx20StructureParser implements parser.SdmxParserProvider {\n    constructor() {\n\n    }\n    getVersionIdentifier(): number {\n        return 2.1;\n    }\n    canParse(input: string): boolean {\n        if (input == null) return false;\n        if (this.isStructure(input)) return true;\n        if (this.isData(input)) return true;\n    }\n    isStructure(input: string): boolean {\n        if (input.indexOf(\"Structure\") != -1 && input.indexOf(\"http://www.SDMX.org/resources/SDMXML/schemas/v2_0/message\") != -1) {\n            return true;\n        } else return false;\n    }\n    isData(header: string): boolean {\n        return false;\n    }\n    isMetadata(header: string): boolean {\n        return false;\n    }\n    parseStructure(input: string): message.StructureType {\n        var srt: Sdmx20StructureReaderTools = new Sdmx20StructureReaderTools(input);\n        return srt.getStructureType();\n\n    }\n    parseData(input: string): message.DataMessage {\n        var opts: sax.SAXOptions = <sax.SAXOptions>{};\n        var parser: sax.SAXParser = sax.parser(/*strict=*/true,/*SaxOptions*/opts);\n\n        parser.onerror = function(e) {\n            // an error happened.\n        };\n        parser.ontext = function(t) {\n            // got some text.  t is the string of text.\n        };\n        parser.onopentag = function(node) {\n            // opened a tag.  node has \"name\" and \"attributes\"\n            console.log(\"open:\" + node);\n        };\n        parser.onclosetag = function(e) {\n            console.log(\"close:\" + e);\n\n        }\n        parser.onattribute = function(attr) {\n            // an attribute.  attr has \"name\" and \"value\"\n        };\n        parser.onend = function() {\n            // parser stream is done, and ready to have more stuff written to it.\n        };\n\n        parser.write(input).close();\n        return null;\n    }\n}\nexport class Sdmx20StructureReaderTools {\n    private struct: message.StructureType = null;\n\n    constructor(s: string) {\n        var dom: any = parseXml.parseXml(s);\n        this.struct = this.toStructureType(dom.documentElement);\n    }\n    toStructureType(structure: any): message.StructureType {\n        this.struct = new message.StructureType();\n        var childNodes = structure.childNodes;\n\n        this.toHeader(this.findNodeName(\"Header\", childNodes));\n        this.toCodelists(this.findNodeName(\"CodeLists\", childNodes));\n        this.toConcepts(this.findNodeName(\"Concepts\", childNodes));\n        this.toKeyFamilies(this.findNodeName(\"KeyFamilies\", childNodes));\n        return this.struct;\n    }\n    toHeader(headerNode: any) {\n        var header: message.Header = new message.Header()\n        header.setId(headerNode.getElementsByTagName(\"ID\")[0].childNodes[0].nodeValue);\n        var test:string= headerNode.getElementsByTagName(\"Test\")[0].childNodes[0].nodeValue;\n        header.setTest(test==\"true\");\n        var prepared:string =headerNode.getElementsByTagName(\"Prepared\")[0].childNodes[0].nodeValue; #\n        var prepDate: xml.DateTime = new xml.DateTime.fromString(prepared);\n        header.setPrepared(new message.HeaderTimeType(prepDate));\n        alert(\"test=\" + header.getTest());\n        alert(\"prepared=\" + header.getPrepared().getDate().toString());\n\n                var childNodes = headerNode.childNodes;\n        for (var i: number = 0; i < childNodes.length; i++) {\n            alert(childNodes[i].nodeName + \":\" + childNodes[i].nodeName);\n        }\n\n        return header;\n    }\n    toCodelists(codelistsNode: any) {\n        return null;\n    }\n    toConcepts(conceptsNode: any) {\n        return null;\n    }\n    toKeyFamilies(keyFamiliesNode: any) {\n        return null;\n    }\n    getStructureType(): message.StructureType {\n        return this.struct;\n    }\n    myLoop(x: any): string {\n        var i: number, y: any, xLen: number, txt: string;\n        txt = \"\";\n        x = x.childNodes;\n        xLen = x.length;\n        for (i = 0; i < xLen; i++) {\n            y = x[i];\n            if (y.nodeType != 3) {\n                if (y.childNodes[0] != undefined) {\n                    txt += this.myLoop(y);\n                }\n            } else {\n                txt += y.nodeValue + \"<br>\";\n            }\n        }\n        return txt;\n    }\n    myLoop2(x: any): string {\n        var i: number, y: any, xLen: number, txt: string;\n        txt = \"\";\n        x = x.childNodes;\n        xLen = x.length;\n        for (i = 0; i < xLen; i++) {\n            y = x[i];\n            if (y.nodeType != 3) {\n                alert(y.nodeName + \":\" + y.nodeValue);\n                if (y.childNodes[0] != undefined) {\n                    txt += this.myLoop2(y);\n                }\n            } else {\n                txt += y.nodeValue + \"<br>\";\n\n            }\n        }\n        return txt;\n    }\n    findNodeName(s: string, childNodes: any) {\n        for (var i: number = 0; i < childNodes.length; i++) {\n            var nn: string = childNodes[i].nodeName;\n            if (nn.indexOf(s) != -1) {\n                alert(\"found node:\"+s);\n                return childNodes[i];\n            }\n        }\n        alert(\"not found node:\"+s);\n        return null;\n    }\n    findTextNode(node: any): string {\n        if( node == null ) return \"\";\n        var childNodes = node.childNodes;\n        for (var i: number = 0; i < childNodes.length; i++) {\n            var nodeType = childNodes[i].nodeType;\n            if (nodeType == 3) {\n                return childNodes[i].nodeValue;\n            }\n        }\n        return \"\";\n    }\n\n}\n\n\n\n\nsdmx.SdmxIO.registerParserProvider(new Sdmx20StructureParser());"],"sourceRoot":"/source/"}